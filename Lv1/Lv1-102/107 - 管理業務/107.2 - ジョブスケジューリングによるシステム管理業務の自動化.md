# LinuC Lv1-102
## 107.2 管理業務 - `ジョブスケジューリングによるシステム管理業務の自動化` ★★★★☆
> cronまたはanacronを使用して定期的にジョブを実行したり、atを使用して指定時刻にジョブを実行できる.
---
### <span style="color: red; ">**`crond`**</span>
> **定期的に実行するジョブのスケジュールを管理する**デーモン.

</br>

### ジョブスケジューリングに関するコマンド
#### <span style="color: red; ">**`crontab`**</span> - ユーザ用crondの設定ファイルを編集
> **ユーザ用の`/var/spool/cron/crontabs`ファイルを編集する**コマンド.
- 書式
    ```sh
    crontab [オプション]
    ```
- オプション
    | オプション | 説明 |
    |:----------|:----|
    | **-e** | 設定ファイル(crontabファイル)を編集 (edit) |
    | **-l** | 設定ファイルを表示 (list) |
    | **-r** | 設定ファイルを削除 (remove) |

</br>

#### <span style="color: red; ">**`at`**</span> - 1回実行のスケジュール指定
- 書式
    ```sh
    at [オプション] [日時]
    ```
    - 日時はHH:MMの形式で指定.
- オプション
    | オプション | 説明 |
    |:----------|:----|
    | **-l** | 予約したジョブを表示 (atq (atquery) コマンドと同様) |
    | **-d ジョブ番号** | 予約したジョブを削除 (atrm (atremove) コマンドと同様) |

</br>

#### <span style="color: red; ">**`batch`**</span> - 1回実行
> **システムの負荷の少ないタイミングで1回だけコマンドを自動実行**する.
>- ジョブの管理はatコマンドを使用して行う.
- 書式
    ```sh
    batch [オプション]
    ```

</br>

### ジョブスケジューリングに関するファイル
#### <span style="color: red; ">**`/var/spool/cron/`**</span>ファイル - ユーザ用のジョブスケジューリング情報
> **ユーザのcrontabファイルが置かれる**ディレクトリ.
- 書式
    ```sh
    [分] [時] [日] [月] [曜日] [コマンド]
    ```

</br>

#### <span style="color: red; ">**`/etc/crontab`**</span>ファイル - システム用のジョブスケジューリング情報
> **システムのcrontabファイルが置かれる**ディレクトリ.
>- `crontab`ファイルでは**1行ごとに、自動的に実行するコマンドおよびその実行日時を指定**.
>- 各コマンドの**実行ユーザも指定する必要**がある.
- 書式
    ```sh
    [分] [時] [日] [月] [曜日] [実行ユーザ名(システム用設定ファイルでのみ指定)] [コマンド]
    ```
- 日付の指定
    |  | 説明 |
    |:--|:----|
    | **分** | 0~59の範囲指定 |
    | **時** | 0~23の範囲指定 |
    | **日** | 1~31の範囲指定 |
    | **曜日** | 0~7の範囲指定 (0,7=日曜 1=月曜 ... 6=土曜) |

    | 表記 | 説明 | 例 |
    |:----|:----|:---|
    | **\*** | 全値に一致 |  |
    | **-** | 範囲の指定 | 時に `1-3` と指定で**1から3まで**を意味 |
    | **,** | 複数の値の指定 | 時に `1,2,3` と指定で**1,2,3**を意味 |
    | **/** | 間隔の指定 | 時に `1-7/2` と指定で**1から7の間で2時間おき**を意味 |

- cronで定期的に実行するジョブを格納するディレクトリ 】
    | ディレクトリ名 | 説明 |
    |:-------------|:-----|
    | **/etc/cron.hourly** | **毎時**実行するスクリプトを格納 |
    | **/etc/cron.daily** | **毎日**実行するスクリプトを格納 |
    | **/etc/cron.monthly** | **毎月**実行するスクリプトを格納 |
    | **/etc/cron.weekly** | **毎週**実行するスクリプトを格納 |
    | **/etc/cron.d** | **定期的なジョブの自動実行**をサービスごとに定義したファイルを格納 |

</br>

#### <span style="color: red; ">**`/etc/anacrontab`**</span>ファイル - ジョブスケジューリング情報
> cronによる**ジョブスケジューリングを補完する**ツール.
>- **ジョブ実行定義ファイル`/etc/anacrontab`を参照し、ジョブを実行**.
- 特徴
    - **日単位で実行タイミング**を指定.
    - ログのロケーションや不要ファイルの削除, **実行履歴などを管理**.
- 書式
    ```sh
    実行間隔日数  実行待機時間(分)  実行日の記録ファイル  実行コマンド
    ```
- **ジョブ実行時間帯を設定する項目**
    ```sh
    START_HOURS_RANGE=開始時刻-終了時刻 (開始時刻 < 終了時刻)
    ```
- **全ジョブの実行時に追加されるランダムな待機時間を設定する項目**
    ```sh
    RANDOM_DELAY=分
    ```

</br>

### cronを利用するユーザを制限
> **`/etc/cron.allow`と`/etc/cron.deny`ファイルが存在しない場合rootユーザのみが利用可能**.
#### <span style="color: red; ">**`/etc/cron.allow`**</span>ファイル - cron実行ユーザの許可
> cronを利用を許可するユーザを記載.
>- 指定がなかったら, すべてのユーザがcron実行可能.

</br>

#### <span style="color: red; ">**`/etc/cron.deny`**</span>ファイル - cron実行ユーザの拒否
> cronを利用を拒否するユーザを記載.

</br>

### atを利用するユーザを制限
> **`/etc/at.allow`と`/etc/at.deny`ファイルが存在しない場合rootユーザのみが利用可能**.
#### <span style="color: red; ">**`/etc/at.allow`**</span>ファイル - at実行ユーザの許可
> atを利用を許可するユーザを記載
>- `/etc/at.allow`ファイルが存在する場合、`/etc/at.deny`ファイルの設定は無視される.
>- 指定がなかったら, rootユーザのみがat実行可能.

</br>

#### <span style="color: red; ">**`/etc/at.deny`**</span>ファイル - at実行ユーザの拒否
> atを利用を拒否するユーザを記載.
