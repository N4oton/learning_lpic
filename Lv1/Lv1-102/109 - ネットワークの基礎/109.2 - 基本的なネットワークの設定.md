# LinuC Lv1-102
## 109.2 ネットワークの基礎 - `基本的なネットワーク構成` ★★★★☆
---
### ホスト名を一時的に変更
#### <span style="color: red; ">**`hostname`**</span>
> **ホスト名を一時的に変更する**コマンド.
- 書式
    ```sh
    hostname [ホスト名]
    ```

</br>

### ホスト名を恒久的に変更
> ホスト名を記述するファイルはディストリビューションによって異なる.
#### <span style="color: red; ">**`/etc/hostname`**</span>
> *Debian系ディストリビューション*で**ホスト名のみを記述**する.
#### <span style="color: red; ">**`/etc/sysconfig/network`**</span>
> *Red Hat系ディストリビューション*で**ホスト名や, ネットワーク機能の有効/無効, デフォルトゲートウェイの設定などを記述**する.

</br>

### <span style="color: red; ">**`/etc/hosts`**</span>
> **名前解決**に用いられるシンプルなテキストファイル.
- 1行に1つのIPアドレスがあり, その**IPアドレスと続くホスト名とを関連づけ**ている.
- IPアドレスは**IPv4, IPv6どちらでも指定可能**.
- 書式
    ```sh
    IPアドレス ホスト名 ホスト名（別名） …
    ```

</br>

### <span style="color: red; ">**`/etc/nsswitch.conf`**</span>
> **GNU Cライブラリが名前解決やサービス名解決の際の問い合わせ順序を指定** (名前解決の優先順序を変更) するファイル.
- **`hosts:`** に続けて優先順位の高い方から名前解決方法を記述する.
- ex.) cat /etc/nsswitch.conf
    ```math
    hosts: files dns
    ```
#### <span style="color: red; ">**`getent`**</span>
> `/etc/nsswitch.conf`の設定に従って検索を行うコマンド.
- 書式
    ```sh
    getent データベース名 [ キー ... ]
    ```
    - データベース名に`/etc/nsswitch.conf`で指定できるサービス名をキーに指定することで, 名前解決順序設定に従って検索した結果が得られる.

</br>

### <span style="color: red; ">**`/etc/host.conf`**</span>
> 名前解決の際の**問い合わせの優先順序を指定する**ファイル.
- **`order`** に続けて優先順位の高い方から名前解決方法を記述する.
- ex.) cat /etc/host.conf
    ```math
    order hosts,bind
    ```

</br>

### <span style="color: red; ">**`/etc/resolv.conf`**</span>
>- 名前解決に利用する**DNSサーバの指定**や, **ドメインの指定**をするファイル. (**DNSの名前解決問い合わせ**に関するオプション)
>- resolver (リゾルバ) ... DNSサーバに問い合わせに行く
- **`nameserver`の後にDNSサーバのIPアドレス**, **`domain`の後に自ドメイン名**, **`search`の後にドメイン名検索リスト**を指定.
    - 設定項目
        | 項目 | 説明 |
        |:---|:---|
        | **nameserver** | 名前解決に使用するDNSサーバ |
        | **domain** | 自サーバの所属するドメイン名 |
        | **search** | 省略されうるドメイン名のリスト |
- 問い合わせ順序
    1. DNSサーバ 192.168.1.1に最初に問い合わせる
    2. 192.168.1.1から応答がなければ, 192.168.1.2に問い合わせる
- 名前解決の対象がホスト名のみ（＝ドットを含まない）の場合
    1. リストの1番目（test1.domain）をホスト名につけて名前解決
    2. リストの1番目のドメインを追加して名前解決に失敗した場合, リストの2番目（test2.domain）を追加して名前解決

</br>

### <span style="color: red; ">**`ip`**</span>
> ifconfigに代わって利用が推奨されるコマンド.
- 書式
    ```sh
    ip オブジェクト コマンド [値]
    ```
    - オブジェクト
        | オブジェクト | 説明 |
        |:---|:---|
        | **addr** | IPv4, IPv6アドレス |
        | **link** | ネットワークデバイス |
        | **neighbour** (neighbor) | IPv4のARPキャッシュ, IPv6のNDキャッシュ |
        | **route** | ルーティングテーブル |    
    - コマンド
        | コマンド | 説明 |
        |:---|:---|
        | **add** | 値の追加 |
        | **del** | 値の削除 |
        | **show** | 現在の状態の表示 |
    - オブジェクトやコマンドは**短縮して指定することも可能**.
- 経路情報を表示する
    ```sh
    ip route show
    ```
- 経路情報を追加する
    ```sh
    ip route add 宛先ネットワークアドレス/サブネットマスク長 via ゲートウェイアドレス [ dev 出力インタフェース ]

    ip route add 192.168.3.0/24 via 192.168.1.1
    ```
- インターフェースを有効/無効化する (linkオブジェクトにsetコマンドを発行する)
    ```sh
    ip link set インタフェース up|down
    ```
</br>

### <span style="color: red; ">**`ルーティングテーブル`**</span>
> ホストはパケットを送信する際, ルーティングテーブルを参照して送信先を決定.
- ルーティングテーブルの主な項目
    |    |    |
    |:---|:---|
    | **Destination** | 宛先ネットワークアドレス (デフォルトルートは **default**) |
    | **Gateway** | 宛先ネットワークへのゲートウェイ (デフォルトルートは デフォルトゲートウェイ) |
    | **Genmask** | 宛先ネットワークへのサブネットマスク (デフォルトルートは 0.0.0.0) |
    | **Flags** | 状態フラグ |
    | **Iface** | 宛先ネットワークへの送信に使用するインターフェース |
    - 状態フラグの項目
        |    |    |
        |:---|:---|
        | **U** | 経路が有効 |
        | **H** | 対象をホストとして設定 |
        | **G** | ゲートウェイを使用 |
- 宛先ネットワークがルーティングテーブルの「Destination」に存在しない場合 (**他に宛先がない場合**)
    - **デフォルトルートの存在を確認**し, 存在する場合はデフォルトルートの「Gateway」へ送信.
        ```
        デフォルトルート ... Linuxのルーティングテーブルでは「default」と表示.
        ```

</br>

### <span style="color: red; ">**`Linuxをルータとして使用する`**</span>
> 異なるネットワーク間（複数のネットワークインターフェース間）でのパケットの転送を許可する必要がある.
- パケットの転送を許可するには **`/proc/sys/net/ipv4/ip_forward`ファイルの内容を1にする**.
    ```sh
    echo 1 > /proc/sys/net/ipv4/ip_forward
    ```