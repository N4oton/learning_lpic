# LinuC Lv1-102
## 110.3 セキュリティ - `暗号化によるデータの保護` ★★★☆☆
> 公開鍵技術を使用して、データおよび通信を保護できる.
---
### SSH接続 (Secure SHell)
>公開鍵認証や通信の暗号化といった点でTELNET(ポート23)よりセキュリティが強固
>- linuxで通常使われるSSHのオープンソースはOpenSSH.
1. ホスト認証（公開鍵方式）
    - サーバの持つ公開鍵をクライアントの`~/.ssh/known_hosts`に登録しておく.
    - クライアントが**サーバへSSH接続を行った際**、クライアントは**登録されている公開鍵とサーバの公開鍵が一致するかどうかを確認**する.
    - 一致しなければログインしない.

2. ユーザ認証（公開鍵方式、もしくはID/パスワード方式）
    - クライアントの持つ公開鍵をサーバの`~/.ssh/authorized_keys`に登録しておく.
    - **サーバがSSH接続を受け付けた際**、サーバは**登録されている公開鍵とユーザの公開鍵が一致するかどうかを確認**する.
    - 一致しなければログインさせない.

</br>

- SSHクライアントで**作成したパスフレーズは表示・削除はできない**.
- `~/.ssh/authorized_keys`はサーバの認証鍵リストで**クライアントの公開鍵を登録**.
- `~/.ssh/known_hosts`はクライアントの認証鍵リストで**サーバの公開鍵を登録**.

</br>

### SSHに関する主なファイル
![img](https://ping-t.com/mondai3/img/jpg/k21964.jpg)
#### <span style="color: red; ">**`/etc/ssh/sshd_config`**</span> - SSHのデーモン`sshd`の設定ファイル
> `PermitRootLogin` - rootユーザの**SSHログインの許可/不許可の設定**.
>- **不許可とする場合は項目を`no`** とします。(デフォルトは`yes`)

</br>

### SSHに関するコマンド
#### <span style="color: red; ">**`ssh`**</span>コマンド - - リモートマシンにログイン 
- 書式
    ```sh
    ssh [オプション] [ログインユーザ名@]ホスト名 [コマンド]
    ```
- オプション
    | オプション | 説明 |
    |:----------|:-----|
    | **-l** | ログイン**ユーザ名の指定** (-lオプションと[ユーザ名@]が省略で現在ユーザ使用) |
    | **-p** | 接続先**ポート番号** |
    | **-o** | ssh_configで**設定できるオプション**を指定 |
    | **-X** | X11の転送を有効化 (**DISPLAY環境変数が自動設定**) |
    | **-x** | x11の転送を無効化 |
</br>

#### <span style="color: red; ">**`SSHポートフォワーディング`**</span>
- **ローカルポートの転送**の書式
    - sshの`-L`オプション
    ```sh
    ssh -L 転送対象ポート番号:SSHサーバから見た接続先アドレス:SSHサーバからの接続先ポート番号 [SSH接続ユーザー名@]SSHサーバアドレス

    例)ローカルのポート8080への接続を、外部Webサーバ（www.example.com）のポート80へ転送する
    ssh -L 8080:www.example.com:80 user@ssh-server
    ```
- **リモートポートの転送**の書式
    - sshの`-R`オプション
    ```sh
    ssh -R 転送対象ポート番号:SSHクライアントから見た接続先アドレス:SSHクライアントからの接続先ポート番号 [SSH接続ユーザー名@]SSHサーバアドレス

    例)SSHサーバのポート8080へのアクセスは、SSHクライアントのポート80（Webサーバ）へ転送する
    ssh -R 8080:localhost:80 user@ssh-server
    ```

</br>

#### <span style="color: red; ">**`ssh-keygen`**</span>コマンド - - SSHで公開鍵と秘密鍵のペアを作成
- 書式
    ```sh
    ssh-keygen [オプション]
    ```

</br>

#### <span style="color: red; ">**`ssh-agent`**</span>コマンド - - ssh-agentの起動
> メモリ上に**秘密鍵を保管しておく認証エージェント**.
>- **SSH接続時にパスフレーズを聞かれないようにできる**.
- 書式
    ```sh
    ssh-agent [オプション]
    ```

</br>

### 暗号化に関するコマンド
> ファイル暗号化にはGnuPG(GNU Privacy Guard)を使用.
>- 暗号化のアルゴリズムとして公開鍵暗号方式と共通鍵暗号方式を用いる.
>- GnuPGはgpgコマンドで操作.
#### <span style="color: red; ">**`gpg`**</span>コマンド - - ファイルの暗号化・複号化を行う
- 書式
    ```sh
    gpg [オプション]
    ```
- オプション
    | オプション | 説明 |
    |:----------|:-----|
    | **オプションなし ファイル名** | **ファイルを複号化** | 
    | **--gen-key** | 公開鍵暗号方式の**キーペアを生成** |
    | **--export** | 公開鍵を**エクスポート** |
    | **--import** | 公開鍵を**インポート** |
    | **--list-keys** | 公開鍵を**一覧表示** |
    | **-e ファイル名** | **相手側の公開鍵を使用してファイルを暗号化** |
    | **-r Mailアドレス** | 使用する**公開鍵の持ち主のMailアドレス** |
    | **-o ファイル名** | **出力ファイル名** |