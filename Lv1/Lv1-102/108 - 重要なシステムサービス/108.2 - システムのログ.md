# LinuC Lv1-102
## 108.2 重要なシステムサービス - `システムのログ` ★★★☆☆
> syslogデーモンを設定できる。また, システムログ代替機能としてのrsyslog およびsyslog-ngについての認知も含まれる.
---
#### <span style="color: red; ">**`syslogd`**</span>
- システムからの**ログを指定したファイルやコンソール画面, 外部のサーバへと出力**.

</br>

#### <span style="color: red; ">**`systemd-journald`**</span>
- systemdの動作するシステムで, **ユニットが出力するログを扱う**デーモンプログラム.
- **設定は`etc/systemd/journald.conf`で行う**.

</br>

#### <span style="color: red; ">**`klogd`**</span>
- **カーネルからのログメッセージを最初に受け取る**デーモン.

</br>

### ログに関するファイル
#### <span style="color: red; ">**`/etc/syslog.conf`**</span> - **syslogの設定ファイル**
> syslogdデーモンの**ログメッセージの出力先を設定**.
- 書式
    ```sh
    ・ファシリティ.プライオリティの単独指定
        ファシリティ.プライオリティ 出力先

    ・ファシリティ.プライオリティの複数指定
        ファシリティ1.プライオリティ1;ファシリティ2.プライオリティ2; ... 出力先
    ```
- ファシリティ (メッセージの出力先)
    | ファシリティ | 説明 |
    |:------|:-----|
    | **auth** | **認証**サービス |
    | **cron** | **cron** |
    | **daemon** | 各種**デーモン** |
    | **kern** | **カーネル** |
    | **lpr** | **印刷**サービス |
    | **mail** | **メール**サービス |
    | **syslog** | **syslogd**デーモン |
    | **local0~7** | **独自利用**可 |
    - **`*`を使うとすべてのファシリティ**を示す.

- プライオリティ (メッセージの優先度)
    | プライオリティ | 説明 |
    |:------|:-----|
    | **emerg** | **非常に危険**な状態 |
    | **alert** | **緊急対応が必要**な状態 |
    | **crit** | **危険**な状態 |
    | **err** | 一般的な**エラーメッセージ** |
    | **warning** | **警告**メッセージ |
    | **notice** | **通知**メッセージ |
    | **info** | **情報**メッセージ |
    | **debug** | **デバッグ**情報 |
    | **none** | ファシリティ無効 (**メッセージを送らない**) |
    - **`*`を使うとすべてのプライオリティ**を示す.
    - **特定のレベルのログだけを指定するには`=`**とする.

- 出力先
    | 表記 | 説明 |
    |:------|:-----|
    | **ファイル名** | **ファイル**への出力 |
    | **ユーザー名** | **ユーザーの端末**への出力 |
    | **@ホスト名**	| **リモートホスト**のsyslogdへの出力 |
    | **/dev/console** | **コンソール**への出力 |
    | **\*** | **全てのユーザー**の端末への出力 |

</br>

#### <span style="color: red; ">**`/etc/rsyslog.conf`**</span> - **rsyslogの設定ファイル**
> ログ転送にTCP、SSL/TLS利用可能などのセキュリティを高めた, 次世代のsyslog.

</br>

#### <span style="color: red; ">**`/etc/logrotate.conf`**</span> - **ログメッセージを生成**
> **ログローテーション機能を利用**し, ログファイルの自動的分割・更新.

</br>

### ログに関するコマンド
#### <span style="color: red; ">**`logger`**</span>コマンド - **systemdのログ表示**
> `/etc/syslog.conf`の**ログに関する設定内容を確認**.
- 書式
    ```sh
    logger [-p ファシリティ.プライオリティ] [-t タグ] メッセージ
    ```

</br>

#### <span style="color: red; ">**`journalctl`**</span>コマンド - **systemdのログ表示**
> **systemd-journaldのログ(各Unitが出力するログ)を表示**する.
>- systemd-journaldが書き込むログファイルはバイナリ形式のため, **catコマンドなどで中を表示することが出来ない**.
>- デフォルトでlessを**ページャとしてログ表示を行う**.
- 書式
    ```sh
    journalctl [オプション] [検索文字列]
    ```
- オプション
    | オプション | 説明 |
    |:------|:-----|
    | **-a** (--all) | 画面表示できない文字も含めて**すべて表示** |
    | **-b** (--boot) | 特定**システム起動時のログを表示** |
    | **-f** (--follow) | 新規に追加された**ログをリアルタイムに表示** |
    | **-k** (--dmesg) | **カーネルからのメッセージを表示** |
    | **-l** (--full) | **表示可能なすべてのログを表示** |
    | **-n** (--lines) **行数** | 指定**行数分表示** |
    | **-r** (-reverse) | **逆順に表示**する |
    | **--no-pager** | **ページャを使用せず**一括でログを表示 |
    | **-o** (--output) | ログ**出力形式を指定** |
    | **--since 日付** | **指定日付以降のログ**を表示 |
    | **--until 日付** | **指定日付以前のログ**を表示 |

- 検索条件指定
    | 検索キー | 説明 |
    |:------|:-----|
    | **_PID** | **プロセス番号指定** |
    | **_SYSTEMD_UNIT=** | **Unit名の指定** (**-uオプションと同様**) |